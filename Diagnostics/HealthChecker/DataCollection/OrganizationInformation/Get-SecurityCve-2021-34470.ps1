# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

. $PSScriptRoot\..\..\..\..\Shared\ErrorMonitorFunctions.ps1
function Get-SecurityCve-2021-34470 {
    [CmdletBinding()]
    param(
        [object]$MsExchStorageGroup
    )
    process {
        Write-Verbose "Calling: $($MyInvocation.MyCommand)"
        $unknown = $null -eq $MsExchStorageGroup
        $isVulnerable = "Unknown"
        try {
            $isVulnerable = (-not $unknown) -and $MsExchStorageGroup.Properties["PossSuperiors"] -eq "computer"
        } catch {
            Write-Verbose "Failed to evaluate MsExchStorageGroup"
            Invoke-CatchActions
        }

        Write-Verbose "Unknown: $unknown IsVulnerable: $isVulnerable"
        return [PSCustomObject]@{
            Unknown      = $unknown
            IsVulnerable = $isVulnerable
        }
    }
}
